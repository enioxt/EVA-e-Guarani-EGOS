<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVA & GUARANI - Quantum Unified Dashboard</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="/static/js/metadata-client.js"></script>

    <style>
        .quantum-metric {
            transition: all 0.5s ease-in-out;
        }

        .mycelium-node {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .anomaly-alert {
            animation: fadeInOut 2s infinite;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0.7;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.7;
            }
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <header>
            <h1>EVA & GUARANI</h1>
            <div class="connection-status">
                <span id="connection-indicator" class="status-indicator"></span>
                <span id="connection-text">Connecting...</span>
            </div>
        </header>

        <main class="dashboard-grid">
            <!-- Quantum Metrics Section -->
            <section class="dashboard-card" id="quantum-metrics">
                <h2>Quantum Metrics</h2>
                <div class="metrics-grid">
                    <div class="metric">
                        <label>Consciousness</label>
                        <span id="consciousness-value">0.000</span>
                    </div>
                    <div class="metric">
                        <label>Harmony</label>
                        <span id="harmony-value">0.000</span>
                    </div>
                    <div class="metric">
                        <label>Evolution</label>
                        <span id="evolution-value">0.000</span>
                    </div>
                    <div class="metric">
                        <label>Integration</label>
                        <span id="integration-value">0.000</span>
                    </div>
                </div>
            </section>

            <!-- Dependency Graph Section -->
            <section class="dashboard-card" id="dependency-graph">
                <h2>System Dependencies</h2>
                <div id="graph-container"></div>
            </section>

            <!-- ML Analysis Section -->
            <section class="dashboard-card" id="ml-analysis">
                <h2>Machine Learning Analysis</h2>
                <div class="ml-grid">
                    <div class="ml-card">
                        <h3>Anomalies</h3>
                        <ul id="anomalies-list"></ul>
                    </div>
                    <div class="ml-card">
                        <h3>File Clusters</h3>
                        <div id="clusters-viz"></div>
                    </div>
                    <div class="ml-card">
                        <h3>Usage Predictions</h3>
                        <div id="predictions-chart"></div>
                    </div>
                    <div class="ml-card">
                        <h3>Optimizations</h3>
                        <ul id="optimizations-list"></ul>
                    </div>
                </div>
            </section>

            <!-- Active Files Section -->
            <section class="dashboard-card" id="active-files">
                <h2>Active Files</h2>
                <div class="files-list" id="files-container"></div>
            </section>
        </main>
    </div>

    <script>
        // Initialize MetadataClient
        const client = new MetadataClient();

        // Connection status handling
        client.on('connected', () => {
            document.getElementById('connection-indicator').className = 'status-indicator online';
            document.getElementById('connection-text').textContent = 'Connected';
        });

        client.on('disconnected', () => {
            document.getElementById('connection-indicator').className = 'status-indicator offline';
            document.getElementById('connection-text').textContent = 'Disconnected';
        });

        // Quantum metrics update handling
        client.on('quantum_update', (data) => {
            Object.entries(data).forEach(([key, value]) => {
                const element = document.getElementById(`${key.toLowerCase()}-value`);
                if (element) {
                    element.textContent = value.toFixed(3);
                    element.className = getMetricClass(value);
                }
            });
        });

        // ML updates handling
        client.on('ml_update', (data) => {
            if (data.anomalies) {
                updateAnomaliesList(data.anomalies);
            }
            if (data.clusters) {
                updateClustersVisualization(data.clusters);
            }
            if (data.predictions) {
                updatePredictionsChart(data.predictions);
            }
            if (data.optimizations) {
                updateOptimizationsList(data.optimizations);
            }
        });

        // Utility functions
        function getMetricClass(value) {
            if (value >= 0.99) return 'metric-excellent';
            if (value >= 0.95) return 'metric-good';
            if (value >= 0.90) return 'metric-warning';
            return 'metric-critical';
        }

        function updateAnomaliesList(anomalies) {
            const list = document.getElementById('anomalies-list');
            list.innerHTML = anomalies.map(anomaly => `
                <li class="anomaly-item">
                    <strong>${anomaly.file}</strong>
                    <p>${anomaly.reason}</p>
                    <span class="score">Score: ${anomaly.score.toFixed(3)}</span>
                </li>
            `).join('');
        }

        function updateClustersVisualization(clusters) {
            const container = document.getElementById('clusters-viz');
            // Use D3.js to create force-directed graph
            // Implementation details...
        }

        function updatePredictionsChart(predictions) {
            const container = document.getElementById('predictions-chart');
            // Use Plotly to create time series chart
            // Implementation details...
        }

        function updateOptimizationsList(optimizations) {
            const list = document.getElementById('optimizations-list');
            list.innerHTML = optimizations.map(opt => `
                <li class="optimization-item">
                    <strong>${opt.type}</strong>
                    <p>${opt.suggestion}</p>
                    <span class="impact">Impact: ${opt.impact}</span>
                </li>
            `).join('');
        }
    </script>
</body>

</html>
